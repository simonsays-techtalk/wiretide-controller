#!/bin/sh /etc/rc.common
# Wiretide Agent init.d service

START=95
STOP=10
NAME="wiretide-agent"
PROG="/etc/wiretide-agent-run"
PIDFILE="/var/run/$NAME.pid"
LOGFILE="/tmp/wiretide-agent.log"

start() {
    echo "Starting $NAME..."
    mkdir -p /var/run
    nohup "$PROG" >> "$LOGFILE" 2>&1 &
    echo $! > "$PIDFILE"
}

stop() {
    echo "Stopping $NAME..."
    [ -f "$PIDFILE" ] && kill "$(cat "$PIDFILE")" 2>/dev/null && rm -f "$PIDFILE"
}

restart() {
    stop
    sleep 1
    start
}

status() {
    if [ -f "$PIDFILE" ] && kill -0 "$(cat "$PIDFILE")" 2>/dev/null; then
        echo "$NAME is running (PID $(cat "$PIDFILE"))"
    else
        echo "$NAME is not running"
    fi
}

