{% extends "base.html" %}
{% block title %}Clients{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-4">Connected Clients</h1>

<div class="flex items-center mb-4">
  <label class="flex items-center space-x-2">
    <input id="auto-refresh" type="checkbox" class="h-4 w-4 text-blue-600">
    <span class="text-sm text-gray-700 dark:text-gray-300">Auto-refresh every 30 seconds</span>
  </label>
</div>

<div class="bg-white dark:bg-gray-800 shadow rounded p-4">
  {% if clients and clients|length > 0 %}
  <table class="min-w-full text-sm table-auto border">
    <thead>
      <tr class="bg-gray-100 dark:bg-gray-700 text-left">
        <th class="p-2 border">Hostname</th>
        <th class="p-2 border">IP Address</th>
        <th class="p-2 border">MAC Address</th>
        <th class="p-2 border">Type</th>
        <th class="p-2 border">Connected To</th>
      </tr>
    </thead>
    <tbody>
      {% for client in clients %}
      <tr>
        <td class="p-2 border">{{ client.hostname or 'unknown' }}</td>
        <td class="p-2 border">{{ client.ip or 'â€”' }}</td>
        <td class="p-2 border">{{ client.mac }}</td>
        <td class="p-2 border">{{ client.type }}</td>
        <td class="p-2 border">
          <a href="/devices/{{ client.device_type }}/{{ client.connected_mac }}"
             class="text-blue-600 underline">
            {{ client.connected_to }}
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="text-gray-600 dark:text-gray-300 text-center">No clients are currently connected.</p>
  {% endif %}
</div>

<script>
  const checkbox = document.getElementById("auto-refresh");
  let refreshTimer;

  checkbox.addEventListener("change", () => {
    if (checkbox.checked) {
      refreshTimer = setInterval(() => window.location.reload(), 30000);
    } else {
      clearInterval(refreshTimer);
    }
  });
</script>
{% endblock %}
